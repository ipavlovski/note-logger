generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "sqlite"
    url      = "file:./dev.db"
}

model Entry {
    id       Int    @id @default(autoincrement())
    markdown String

    createdAt DateTime  @default(now())
    updatedAt DateTime?
    title     String?
    metadata  String    @default("{}")
    order     Int       @default(0)
    archived  Boolean   @default(false)

    category   Category? @relation(fields: [categoryId], references: [id])
    categoryId Int?
    tags       Tag[]
    files      File[]
}

model Category {
    id    Int     @id @default(autoincrement())
    name  String
    url   String?
    order Int     @default(0)

    entry Entry[]

    pid      Int        @default(0)
    parent   Category?  @relation("CategoryChain", fields: [pid], references: [id])
    children Category[] @relation("CategoryChain")

    icon   File? @relation(fields: [iconId], references: [id])
    iconId Int?

    @@unique([pid, name], name: "unique_name_per_siblings")
}

model Tag {
    id   Int     @id @default(autoincrement())
    name String  @unique
    post Entry[]
}

model File {
    id         Int        @id @default(autoincrement())
    path       String     @unique
    metadata   String     @default("{}")
    entries    Entry[]
    categories Category[]
}
